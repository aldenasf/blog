---
import { getCollection } from "astro:content";
import Page from "../layouts/Page.astro";
import Card from "../components/Card.astro";

const posts = (await getCollection("posts")).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const pinnedPostIndex = posts.findIndex((post) => post.data?.pinned == true);

let pinnedPost;
let pinnedPostExists;

if (pinnedPostIndex !== -1) {
    pinnedPost = posts.splice(pinnedPostIndex, 1)[0];
    pinnedPostExists = true;
} else {
    pinnedPost = posts.shift();
    pinnedPostExists = false;
}
---

<Page>
    <main class="flex flex-wrap justify-center py-2 lg:py-8">
        <div id="pinned-post">
            <div class="flex justify-center">
                <!-- {
                    pinnedPostExists ? (
                        <div class="inline-flex items-center rounded-md bg-red-500 px-2 py-1">
                            <Icon class="mr-2 text-xl" name="carbon:pin-filled" />
                            <h1 class="font-sans text-xs font-semibold text-white lg:text-lg">Pinned Post</h1>
                        </div>
                    ) : (
                        <div class="inline-flex items-center rounded-md bg-yellow-500 px-2 py-1">
                            <Icon class="mr-2 text-xl" name="carbon:star-filled" />
                            <h1 class="text-xs font-semibold text-white lg:text-lg">Latest Post</h1>
                        </div>
                    )
                } -->

                {
                    pinnedPostExists ? (
                        <h1 class="text-md font-semibold text-neutral-300 lg:text-2xl">Pinned Post</h1>
                    ) : (
                        <h1 class="text-md font-semibold text-neutral-300 lg:text-2xl">Latest Post</h1>
                    )
                }
            </div>
            {
                pinnedPost ? (
                    <Card
                        highlighted
                        pinned={pinnedPostExists}
                        href={`${Astro.url.origin}${import.meta.env.BASE_URL}/post/${pinnedPost.slug}`}
                        title={pinnedPost.data.title}
                        date={pinnedPost.data.date}
                        image={pinnedPost.data.image}
                    />
                ) : null
            }
        </div>
        <div id="posts" class="grid grid-cols-1 lg:mt-4 lg:grid-cols-2">
            {
                posts.map((post) => (
                    <Card
                        href={`${Astro.url.origin}${import.meta.env.BASE_URL}/post/${post.slug}`}
                        title={post.data.title}
                        date={post.data.date}
                        image={post.data.image}
                    />
                    // <li>
                    //     <a href={`/blog/${post.slug}/`}>
                    //         <img width={720} height={360} src={post.data.image} alt="" />
                    //         <h4 class="title">{post.data.title}</h4>
                    //         <p class="date">post.data.date</p>
                    //     </a>
                    // </li>
                ))
            }
            <!-- <Card />
            <Card />
            <Card />
            <Card /> -->
        </div>
    </main>
</Page>
